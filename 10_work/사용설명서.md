# 자동화 도구 사용 설명서

`automation_tool.py`는 지정한 루트 폴더를 기준으로 **백업**, **파일 정리**, **워크스페이스 청소**를 순차적으로 수행하는 스크립트입니다. 이 문서는 실행 전 준비 사항, 설정 방법, 실행 절차, 결과 확인 방법을 설명합니다.

## 1. 사전 준비
- Python 3.10 이상 설치.
- `automation_tool.py`와 `automation_config.json`이 동일한 디렉터리에 존재.
- 백업/로그/격리 폴더를 만들 수 있도록 대상 루트 폴더에 쓰기 권한 확보.

권장 가상환경:
```bash
python -m venv .venv
source .venv/bin/activate  # Windows PowerShell: .\.venv\Scripts\Activate.ps1
```

## 2. 주요 파일 및 폴더
| 이름 | 설명 |
| --- | --- |
| `automation_tool.py` | CLI 진입점. 설정을 읽어 모든 작업을 수행. |
| `automation_config.json` | 백업, 정리, 청소 규칙을 정의하는 JSON. |
| `backups/` | 백업 ZIP 파일 저장 디렉터리(자동 생성). |
| `logs/automation_YYYYMMDD.log` | 일자별 실행 로그. |
| `quarantine/duplicates`, `quarantine/expired` | 중복/만료 파일 격리 위치. |

## 3. 설정 파일 작성 가이드 (`automation_config.json`)
```json
{
  "backup_rules": {
    "folders": ["documents", "data"],
    "exclude_patterns": ["*.tmp", "*.cache", "temp_*"],
    "retention_days": 30
  },
  "file_organization": {
    "rules": [
      {"pattern": "*.log", "destination": "logs/archive/", "older_than_days": 7},
      {"pattern": "report_*.docx", "destination": "documents/reports/", "create_year_folders": true}
    ]
  },
  "cleanup": {
    "delete_empty_folders": true,
    "remove_duplicates": true,
    "max_file_age_days": 360
  }
}
```
- `backup_rules.folders`: 루트 기준 백업 대상 폴더 목록. 존재하지 않으면 건너뛰고 경고를 남깁니다.
- `backup_rules.exclude_patterns`: `fnmatch` 패턴으로 백업 제외 대상을 지정합니다.
- `backup_rules.retention_days`: 백업 ZIP 자동 정리 기준 일수. 0 이하이면 보관만 합니다.
- `file_organization.rules`: 각 규칙은 `pattern`(glob), `destination`, 선택적 `older_than_days`, `create_year_folders`(연도별 서브폴더 생성)를 가집니다.
- `cleanup`: `remove_duplicates`는 SHA-256 해시로 중복 파일을 `quarantine/duplicates`로 이동합니다. `max_file_age_days`보다 오래된 파일은 `quarantine/expired`로 이동하며, `delete_empty_folders`가 `true`이면 이후 빈 폴더도 제거됩니다.

## 4. 실행 방법
루트 폴더와 설정 파일 경로를 인수로 전달합니다. 설정 인수를 생략하면 현재 디렉터리의 `automation_config.json`을 사용합니다.
```bash
python automation_tool.py /path/to/workspace -c /path/to/automation_config.json
```
실행 시 동작:
1. 설정 로드 및 `logs/` 생성 후 로거 초기화.
2. `backups/` 하위에 대상 폴더별 ZIP 생성 및 보존 기간 초과 파일 삭제.
3. 정리 규칙에 따라 파일 이동(`create_year_folders` 옵션 시 연도별 폴더 생성).
4. 중복/오래된 파일을 `quarantine`으로 이동하고 빈 폴더 제거.

## 5. 로그 & 결과 확인
- 실행 콘솔과 `logs/automation_YYYYMMDD.log`에 동일한 로그가 기록됩니다.
- 백업 ZIP은 `backups/<폴더명>/<폴더명>_YYYYMMDD_HHMMSS.zip` 형태로 생성됩니다.
- 이동된 파일은 로그에 `파일 이동: <source> -> <destination>`으로 남으므로 문제 발생 시 추적 가능합니다.

## 6. 문제 해결 FAQ
- **"지정한 루트 폴더가 없습니다" 오류**: 명령에 전달한 루트 경로가 실제로 존재하는지 확인합니다.
- **"설정 파일을 찾을 수 없습니다" 오류**: `-c` 인수 또는 기본 경로에 JSON이 있는지 확인합니다.
- **백업 제외가 동작하지 않음**: `exclude_patterns`는 루트 기준 상대경로를 슬래시(`/`)로 비교하므로, Windows 경로 구분자(`\`)가 포함된 경우에도 `/`로 치환해 작성하세요.
- **중복 파일이 계속 발견됨**: `duplicates` 폴더 자체가 다시 스캔되지 않도록 코드가 처리하지만, 루트 외부에 동일 파일이 있을 수 있으므로 근본 원인을 확인합니다.

필요에 따라 Windows 작업 스케줄러, Linux crontab 등에 위 명령을 등록해 주기적으로 실행할 수 있습니다. 주기 실행 시에는 로그/백업 보존 정책을 운영 환경에 맞게 조정하세요.
